{% extends 'base.html' %}
{% load static %}

{% block title %}Nuevo Usuario - PAE{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/usuarios.css' %}?v=3">
{% endblock %}

{% block content %}
<section class="home">
    <div class="form-center-wrapper">
    <div class="card-form">
        <div class="formulario">
            <h2><i class='bx bx-user-plus'></i> Nuevo Usuario</h2>
            
            <form method="post" class="form-usuario">
                {% csrf_token %}
                
                <!-- Documento -->
                <div class="fila">
                    <div class="campo full">
                        <label for="documento">
                            <i class='bx bx-id-card'></i>
                            Documento
                        </label>
                        <input type="number" 
                               id="documento" 
                               name="documento" 
                               required 
                               placeholder="N√∫mero de documento"
                               class="input"
                               value="{{ request.POST.documento }}">
                        <span class="help-text">C√©dula de ciudadan√≠a, tarjeta de identidad, etc.</span>
                    </div>
                </div>

                <!-- Nombres y Apellidos -->
                <div class="fila dos-columnas">
                    <div class="campo">
                        <label for="nombres">
                            <i class='bx bx-user'></i>
                            Nombres
                        </label>
                        <input type="text" 
                               id="nombres" 
                               name="nombres" 
                               required 
                               placeholder="Nombres completos"
                               class="input"
                               value="{{ request.POST.nombres }}">
                    </div>
                    <div class="campo">
                        <label for="apellidos">
                            <i class='bx bx-user'></i>
                            Apellidos
                        </label>
                        <input type="text" 
                               id="apellidos" 
                               name="apellidos" 
                               required 
                               placeholder="Apellidos completos"
                               class="input"
                               value="{{ request.POST.apellidos }}">
                    </div>
                </div>

                <!-- Tel√©fono y Direcci√≥n -->
                <div class="fila dos-columnas">
                    <div class="campo">
                        <label for="telefono">
                            <i class='bx bx-phone'></i>
                            Tel√©fono
                        </label>
                        <input type="tel" 
                               id="telefono" 
                               name="telefono" 
                               required 
                               placeholder="3001234567"
                               class="input"
                               value="{{ request.POST.telefono }}">
                    </div>
                    <div class="campo">
                        <label for="direccion">
                            <i class='bx bx-home'></i>
                            Direcci√≥n
                        </label>
                        <input type="text" 
                               id="direccion" 
                               name="direccion" 
                               required 
                               placeholder="Direcci√≥n completa"
                               class="input"
                               value="{{ request.POST.direccion }}">
                    </div>
                </div>

                <!-- Correo y Contrase√±a -->
                <div class="fila dos-columnas">
                    <div class="campo">
                        <label for="correo">
                            <i class='bx bx-envelope'></i>
                            Correo Electr√≥nico
                        </label>
                        <input type="email" 
                               id="correo" 
                               name="correo" 
                               required 
                               placeholder="usuario@ejemplo.com"
                               class="input"
                               value="{{ request.POST.correo }}">
                    </div>
                    <div class="campo">
                        <label for="password">
                            <i class='bx bx-lock'></i>
                            Contrase√±a
                        </label>
                        <div class="password-wrapper">
                            <input type="password" 
                                   id="password" 
                                   name="password" 
                                   required 
                                   placeholder="Contrase√±a segura"
                                   class="input">
                            <button type="button" class="password-toggle" onclick="togglePassword('password')">
                                <i class='bx bx-show'></i>
                            </button>
                        </div>
                        <span class="help-text">M√≠nimo 6 caracteres</span>
                    </div>
                </div>

                <!-- Rol -->
                <div class="fila">
                    <div class="campo full">
                        <label for="rol">
                            <i class='bx bx-shield'></i>
                            Rol en el Sistema
                        </label>
                        <select id="rol" name="rol" required class="select">
                            <option value="">Seleccione un rol</option>
                            <option value="A" {% if request.POST.rol == 'A' %}selected{% endif %}>
                                üë§ Administrador
                            </option>
                            <option value="EP" {% if request.POST.rol == 'EP' %}selected{% endif %}>
                                üè≠ Empleado de Producci√≥n
                            </option>
                            <option value="EV" {% if request.POST.rol == 'EV' %}selected{% endif %}>
                                üíº Empleado de Ventas
                            </option>
                        </select>
                        <span class="help-text">Define los permisos y accesos del usuario</span>
                    </div>
                </div>

                <!-- Botones -->
                <div class="botones">
                    <button type="submit" class="btn-primario">
                        <i class='bx bx-save'></i>
                        Guardar Usuario
                    </button>
                    <a href="{% url 'usuarios:index' %}" class="btn-secundario">
                        <i class='bx bx-x'></i>
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
    </div>
</section>

<script>
// Funci√≥n para mostrar/ocultar contrase√±a
function togglePassword(fieldId) {
    const passwordField = document.getElementById(fieldId);
    const toggleBtn = passwordField.nextElementSibling.querySelector('i');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        toggleBtn.className = 'bx bx-hide';
    } else {
        passwordField.type = 'password';
        toggleBtn.className = 'bx bx-show';
    }
}

// Validaciones en tiempo real
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.form-usuario');
    const documento = document.getElementById('documento');
    const telefono = document.getElementById('telefono');
    const password = document.getElementById('password');
    
    // Validar documento
    documento.addEventListener('input', function() {
        const valor = this.value;
        if (valor.length < 7 || valor.length > 12) {
            this.setCustomValidity('El documento debe tener entre 7 y 12 d√≠gitos');
        } else {
            this.setCustomValidity('');
        }
    });
    
    // Validar tel√©fono
    telefono.addEventListener('input', function() {
        const valor = this.value;
        if (valor.length !== 10) {
            this.setCustomValidity('El tel√©fono debe tener 10 d√≠gitos');
        } else {
            this.setCustomValidity('');
        }
    });
    
    // Validar contrase√±a
    password.addEventListener('input', function() {
        const valor = this.value;
        if (valor.length < 6) {
            this.setCustomValidity('La contrase√±a debe tener al menos 6 caracteres');
        } else {
            this.setCustomValidity('');
        }
    });
});
</script>
{% endblock %}