<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>Gestión de Ventas</title>
    </h:head>

    <h:body>
        <ui:include src="/views/Navbar.xhtml" />
        <f:event type="preRenderView" listener="#{ventasBean.cargarVentas()}" />    
        <p:growl id="msj" showDetail="true" showSummary="true" />

        <section class="home">
            <div class="contenedor">
                <div class="tabla">
                    <section class="card">
                        <h:form>
                            <div class="encabezado">
                                <h2><i class='bx  bx-bar-chart-big'></i> Gestión de Ventas</h2>
                                <div>

                                    <h:commandButton value="Nueva Venta"  styleClass="export-btn" style="margin-left: 10px" action="nuevaVenta.xhtml?faces-redirect=true" />
                                    <h:commandButton value="Reporte PDF"  styleClass="export-btn" style="margin-left: 10px" actionListener="#{ventasBean.exportarPDF}" />
                                    <h:commandButton value="Gestionar Clientes" styleClass="export-btn" style="margin-left: 10px" action="/views/Clientes/Index.xhtml?faces-redirect=true" />
                                    <h:commandButton value="Migrar" styleClass="export-btn" style="margin-left: 10px" action="/views/Ventas/migrarVentas.xhtml?faces-redirect=true" />
                                </div>

                            </div>


                            <h:panelGroup id="tablaUsuariosWrapper">
                                <div class="wrapper">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Id <span class="draggable" onmousedown="initResize(0)"></span></th>
                                                <th>Tipo <span class="draggable" onmousedown="initResize(1)"></span></th>
                                                <th>Cliente <span class="draggable" onmousedown="initResize(2)"></span></th>
                                                <th>Registrada por <span class="draggable" onmousedown="initResize(3)"></span></th>
                                                <th>Asignado A <span class="draggable" onmousedown="initResize(4)"></span></th>
                                                <th>Total <span class="draggable" onmousedown="initResize(5)"></span></th>
                                                <th>Estado  <span class="draggable" onmousedown="initResize(6)"></span></th>
                                                <th>Observaciones <span class="draggable" onmousedown="initResize(7)"></span></th>
                                                <th style="width:5rem">Opciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <ui:repeat value="#{ventasBean.listaVentas}" var="venta">
                                                <tr>
                                                    <td><span class="cell-content"><h:outputText value="#{venta.idVen}" /></span></td>
                                                    <td><span class="cell-content"><h:outputText value="#{venta.tipo}" /></span></td>
                                                    <td><span class="cell-content"><h:outputText value="#{venta.nombreCliente}" /></span></td>
                                                    <td><span class="cell-content"><h:outputText value="#{venta.nombreUsuario}" /></span></td>
                                                    <td><span class="cell-content"><h:outputText value="#{ventasBean.getNombreAsignado(venta)}" /></span></td>
                                                    <td><span class="cell-content"><h:outputText value="#{venta.total}" /></span></td>
                                                    <td><span class="cell-content"><h:outputText value="#{venta.estado}" /></span></td>
                                                    <td><span class="cell-content"><h:outputText value="#{venta.observaciones}" /></span></td>
                                                    <td>
                                                        <h:commandLink action="editarVentas"
                                                                       actionListener="#{ventasBean.prepararEdicion(venta)}"
                                                                       styleClass="btn btn-outline-success ">
                                                            <i class="bi bi-pencil"></i>
                                                        </h:commandLink>

                                                        <h:commandLink onclick="return confirm('¿Está seguro de eliminar la venta?')"
                                                                       actionListener="#{ventasBean.eliminarVenta(venta.idVen)}"
                                                                       styleClass="btn btn-outline-danger btn-sm">
                                                            <i class="bi bi-trash"></i>
                                                        </h:commandLink>

                                                        <h:link outcome="/views/Ventas/gestionarrecetas.xhtml"
                                                                styleClass="btn btn-outline-warning">
                                                            <f:param name="idVenta" value="#{venta.idVen}" />
                                                            <i class="bi bi-eye"></i>
                                                        </h:link>

                                                        <h:link outcome="/views/Ventas/pago.xhtml?faces-redirect=true"
                                                                styleClass="btn btn-outline-success btn-sm"
                                                                title="Gestionar pagos">
                                                            <f:param name="idVenta" value="#{venta.idVen}" />
                                                            <i class="bi bi-receipt"></i>
                                                        </h:link>
                                                    </td>
                                                </tr>
                                            </ui:repeat>
                                        </tbody>
                                    </table>
                                </div>
                            </h:panelGroup>
                            <h:commandLink styleClass="btn-back" action="/views/Dashboard.xhtml?faces-redirect=true"><i class='bx  bx-chevron-left'></i> Volver</h:commandLink>
                        </h:form>
                    </section>         
                </div>
            </div>
        </section>
        <script type="text/javascript" src="/assets/js/tabla.js"></script>
    </h:body>
</html>
