{% extends 'base.html' %}
{% load static %}

{% block title %}Gestionar Ingredientes - {{ receta.nombre }} - Sistema PAE{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/usuarios.css' %}?v=3">
<style>
    .ingredientes-container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .receta-header {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .receta-info h1 {
        margin: 0;
        font-size: 1.8em;
    }
    
    .receta-info p {
        margin: 5px 0 0 0;
        opacity: 0.9;
    }
    
    .receta-precio {
        background: rgba(255,255,255,0.2);
        padding: 10px 20px;
        border-radius: 20px;
        font-size: 1.2em;
        font-weight: bold;
    }
    
    .ingredientes-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .stat-icon {
        font-size: 2em;
        margin-bottom: 10px;
    }
    
    .stat-valor {
        font-size: 1.5em;
        font-weight: bold;
        color: #2c3e50;
    }
    
    .stat-label {
        color: #7f8c8d;
        font-size: 0.9em;
    }
    
    .ingredientes-section {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .section-header {
        background: #f8f9fa;
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .section-header h2 {
        margin: 0;
        color: #2c3e50;
    }
    
    .btn-agregar {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    
    .btn-agregar:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
    }
    
    .ingredientes-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        min-width: 700px;
    }
    
    .table-container {
        width: 100%;
        overflow-x: auto;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .ingredientes-table th,
    .ingredientes-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
    }
    
    .ingredientes-table th:nth-child(1),
    .ingredientes-table td:nth-child(1) { width: 40%; }
    .ingredientes-table th:nth-child(2),
    .ingredientes-table td:nth-child(2) { width: 20%; }
    .ingredientes-table th:nth-child(3),
    .ingredientes-table td:nth-child(3) { width: 20%; }
    .ingredientes-table th:nth-child(4),
    .ingredientes-table td:nth-child(4) { width: 20%; }
    
    .ingredientes-table th {
        background: #f8f9fa;
        font-weight: bold;
        color: #2c3e50;
    }
    
    .ingredientes-table .acciones-cell {
        width: 300px;
        text-align: center;
        white-space: nowrap;
    }
    
    .ingredientes-table tr:hover {
        background: #f8f9fa;
    }
    
    .cantidad-badge {
        background: #3498db;
        color: white;
        padding: 4px 12px;
        border-radius: 15px;
        font-weight: bold;
        font-size: 0.9em;
    }
    
    .costo-ingrediente {
        font-weight: bold;
        color: #e74c3c;
    }
    
    .acciones-cell {
        white-space: nowrap;
        min-width: 300px;
        width: 300px;
        text-align: center;
        padding: 10px !important;
    }
    
    .btn-accion {
        display: inline-block;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        font-size: 18px;
        margin: 0 5px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        text-align: center;
        vertical-align: middle;
        line-height: 40px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .btn-editar {
        background: #f39c12;
        color: white;
        border-color: #f39c12;
    }
    
    .btn-editar:hover {
        background: #e67e22;
        border-color: #e67e22;
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(243, 156, 18, 0.3);
    }
    
    .btn-eliminar {
        background: #e74c3c;
        color: white;
        border-color: #e74c3c;
    }
    
    .btn-eliminar:hover {
        background: #c0392b;
        border-color: #c0392b;
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
    }
    
    .btn-accion:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #7f8c8d;
    }
    
    .empty-state i {
        font-size: 4em;
        margin-bottom: 20px;
        opacity: 0.5;
    }
    
    .empty-state h3 {
        margin-bottom: 10px;
        color: #2c3e50;
    }
    
    .empty-state p {
        margin-bottom: 20px;
    }
    
    .costo-total-card {
        background: linear-gradient(135deg, #8e44ad, #9b59b6);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
    }
    
    .costo-total-valor {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .costo-total-label {
        opacity: 0.9;
    }
    
    .margen-info {
        background: #ecf0f1;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        text-align: center;
    }
    
    .margen-item {
        display: flex;
        flex-direction: column;
    }
    
    .margen-valor {
        font-size: 1.2em;
        font-weight: bold;
        color: #2c3e50;
    }
    
    .margen-label {
        font-size: 0.9em;
        color: #7f8c8d;
    }
    
    /* Modal para agregar ingrediente */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        align-items: center;
        justify-content: center;
    }
    
    .modal[style*="block"] {
        display: flex !important;
    }
    
    .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .modal-content {
        background: white;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .modal-header {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 20px;
        border-radius: 10px 10px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header h3 {
        margin: 0;
    }
    
    .modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.5em;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.3s ease;
    }
    
    .modal-close:hover {
        background: rgba(255,255,255,0.2);
    }
    
    .modal-body {
        padding: 20px;
    }
    
    @media (max-width: 768px) {
        .receta-header {
            flex-direction: column;
            text-align: center;
            gap: 15px;
        }
        
        .ingredientes-table {
            font-size: 0.9em;
        }
        
        .ingredientes-table th,
        .ingredientes-table td {
            padding: 10px 8px;
        }
        
        .btn-accion {
            padding: 4px 8px;
            font-size: 0.8em;
        }
        
        .margen-info {
            grid-template-columns: 1fr;
        }
    }

    /* Estilos para hacer el header m√°s compacto */
    .page-header {
        padding: 10px 0 5px 0 !important;
        margin-bottom: 5px !important;
    }

    .page-header h1 {
        margin-bottom: 3px !important;
        font-size: 1.5em !important;
    }

    .page-description {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
        font-size: 0.9em !important;
    }

    .ingredientes-container {
        margin-top: -5px !important;
        padding-top: 0 !important;
    }

    .ingredientes-stats {
        margin-top: 5px !important;
        margin-bottom: 8px !important;
    }

    .stat-card {
        padding: 8px 12px !important;
    }

    .section-header {
        margin-bottom: 8px !important;
        margin-top: 0 !important;
    }

    .section-header h2 {
        margin-bottom: 0 !important;
        margin-top: 0 !important;
        font-size: 1.3em !important;
    }

    .content-wrapper {
        padding-top: 10px !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="page-header">
        <div class="header-content">
            <h1>
                <i class='bx bx-food-menu'></i>
                Ingredientes de: <span style="color: #3498db;">{{ receta.nombre }}</span>
            </h1>
            <p class="page-description">
                Precio: <strong style="color: #27ae60;">${{ receta.precio }}</strong> | Estado: <strong style="color: {% if receta.estado == 'Activo' %}#27ae60{% else %}#e74c3c{% endif %}">{{ receta.estado }}</strong>
            </p>
        </div>
        <div class="header-actions">
            <a href="{% url 'recetas:index' %}" class="btn btn-secondary">
                <i class='bx bx-arrow-back'></i>
                Volver a Recetas
            </a>
        </div>
    </div>

    <div class="ingredientes-container">
        <!-- Estad√≠sticas compactas -->
        <div class="ingredientes-stats" style="margin-top: 15px; margin-bottom: 20px;">
            <div class="stat-card">
                <div class="stat-icon" style="color: #3498db;">
                    <i class='bx bx-list-ul'></i>
                </div>
                <div class="stat-valor">{{ ingredientes.count }}</div>
                <div class="stat-label">Ingredientes</div>
            </div>
        </div>

        <!-- Secci√≥n de ingredientes -->
        <div class="ingredientes-section">
            <div class="section-header">
                <h2>Ingredientes de la Receta</h2>
                <button onclick="abrirModalAgregar()" class="btn-agregar">
                    <i class='bx bx-plus'></i>
                    Agregar Ingrediente
                </button>
            </div>

            {% if ingredientes %}
            <div class="table-container">
                <table class="ingredientes-table">
                    <thead>
                        <tr>
                            <th><i class='bx bx-package'></i> Insumo</th>
                            <th><i class='bx bx-scales'></i> Cantidad</th>
                            <th><i class='bx bx-ruler'></i> Unidad</th>
                            <th><i class='bx bx-check-shield'></i> Estado</th>
                            <th><i class='bx bx-cog'></i> Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ingrediente in ingredientes %}
                        <tr>
                            <td>
                                <strong>{{ ingrediente.insumo.nombre }}</strong>
                                {% if ingrediente.insumo.descripcion %}
                                    <br><small style="color: #7f8c8d;">{{ ingrediente.insumo.descripcion|truncatechars:50 }}</small>
                                {% endif %}
                            </td>
                            <td>
                                <span class="cantidad-badge">{{ ingrediente.cantidad|floatformat:2 }}</span>
                            </td>
                            <td>{{ ingrediente.insumo.unidad_medida }}</td>
                            <td>
                                {% if ingrediente.estado == 'Activo' %}
                                    <span class="estado-badge activo">
                                        <i class='bx bx-check-circle'></i> Activo
                                    </span>
                                {% else %}
                                    <span class="estado-badge agotado">
                                        <i class='bx bx-x-circle'></i> Agotado
                                    </span>
                                {% endif %}
                                {% if ingrediente.insumo.estado == 'Stock insuficiente' %}
                                    <br><small style="color: #e74c3c; font-size: 0.8em;">
                                        <i class='bx bx-error'></i> Stock: {{ ingrediente.insumo.stock_actual }}
                                    </small>
                                {% endif %}
                            </td>
                            <td class="acciones-cell">
                                <button type="button" onclick="editarIngrediente({{ ingrediente.id_rec_ins }})" 
                                        class="btn-accion btn-editar" title="Editar ingrediente">
                                    <i class='bx bx-edit'></i>
                                </button>
                                <a href="{% url 'insumos:detalle' ingrediente.insumo.id_ins %}?from=receta&id_rec={{ receta.id_rec }}" 
                                   class="btn-accion" 
                                   style="background:#3498db;color:#fff;" 
                                   title="Ver detalle / lotes del insumo" target="_blank">
                                    <i class='bx bx-barcode'></i>
                                </a>
                                <button type="button" onclick="confirmarEliminar({{ ingrediente.id_rec_ins }}, '{{ ingrediente.insumo.nombre }}')" 
                                        class="btn-accion btn-eliminar" title="Eliminar de la receta">
                                    <i class='bx bx-trash'></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                <div class="empty-state">
                    <i class='bx bx-package'></i>
                    <h3>No hay ingredientes</h3>
                    <p>Esta receta a√∫n no tiene ingredientes asignados.</p>
                    <button onclick="abrirModalAgregar()" class="btn-agregar">
                        <i class='bx bx-plus'></i>
                        Agregar Primer Ingrediente
                    </button>
                </div>
            {% endif %}
        </div>


    </div>
</div>

<!-- Modal para agregar/editar ingrediente -->
<div id="modalIngrediente" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitulo">Agregar Ingrediente</h3>
            <button type="button" class="modal-close" onclick="cerrarModal()">
                <i class='bx bx-x'></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="formIngrediente" method="post">
                {% csrf_token %}
                <input type="hidden" id="ingredienteId" name="ingrediente_id">
                
                <!-- Campo para seleccionar insumo (solo en modo agregar) -->
                <div class="campo" id="campoSelectInsumo">
                    <label for="insumo" class="required">
                        <i class='bx bx-package'></i>
                        Insumo
                    </label>
                    <select id="insumo" name="insumo_id" class="input" required>
                        <option value="">Seleccionar insumo...</option>
                        {% for insumo in insumos_disponibles %}
                        <option value="{{ insumo.id_ins }}" 
                                data-unidad="{{ insumo.unidad_medida }}">
                            {{ insumo.nombre }} - {{ insumo.unidad_medida }}
                        </option>
                        {% empty %}
                        <option value="" disabled>No hay insumos disponibles</option>
                        {% endfor %}
                    </select>
                    <!-- DEBUG: Total insumos disponibles: {{ insumos_disponibles|length }} -->
                    <div style="font-size: 12px; color: #999; margin-top: 5px;">
                        Debug: {{ insumos_disponibles|length }} insumos disponibles
                        {% if insumos_disponibles|length == 0 %}
                        <br><strong style="color: red;">¬°No hay insumos activos!</strong>
                        {% endif %}
                    </div>
                    <div style="margin-top:8px;">
                        <a id="linkLotes" href="#" target="_blank" class="btn btn-outline-info" style="pointer-events:none; opacity:.5;">
                            <i class='bx bx-barcode'></i> Ver Lotes / Detalle
                        </a>
                    </div>
                </div>
                
                <!-- Campo para mostrar nombre del insumo (solo en modo editar) -->
                <div class="campo" id="campoNombreInsumo" style="display: none;">
                    <label>
                        <i class='bx bx-package'></i>
                        Insumo
                    </label>
                    <div class="insumo-readonly">
                        <span id="nombreInsumoDisplay"></span>
                        <input type="hidden" id="insumoIdHidden" name="insumo_id">
                    </div>
                    <div style="margin-top:8px;">
                        <a id="linkLotesEditar" href="#" target="_blank" class="btn btn-outline-info" style="pointer-events:none; opacity:.5;">
                            <i class='bx bx-barcode'></i> Ver Lotes / Detalle
                        </a>
                    </div>
                </div>
                
                <div class="campo">
                    <label for="cantidad" class="required">
                        <i class='bx bx-scales'></i>
                        Cantidad
                    </label>
                    <input type="number" 
                           id="cantidad" 
                           name="cantidad" 
                           class="input" 
                           step="0.01" 
                           min="0.01"
                           placeholder="0.00"
                           required>
                    <small id="unidadInfo" style="color: #7f8c8d;"></small>
                </div>
                

                
                <div class="form-actions" style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="cerrarModal()" class="btn btn-secondary">
                        <i class='bx bx-x'></i>
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class='bx bx-save'></i>
                        Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('modalIngrediente');
    const form = document.getElementById('formIngrediente');
    const insumoSelect = document.getElementById('insumo');
    const cantidadInput = document.getElementById('cantidad');
    const unidadInfo = document.getElementById('unidadInfo');
    const lotesLink = document.getElementById('linkLotes');
    const lotesLinkEditar = document.getElementById('linkLotesEditar');
    
    // Mostrar unidad del insumo seleccionado
    function mostrarUnidad() {
        const insumoOption = insumoSelect.selectedOptions[0];
        
        if (insumoOption && insumoOption.value) {
            const unidad = insumoOption.dataset.unidad || '';
            unidadInfo.textContent = `Unidad: ${unidad}`;
            // Activar link a detalle/lotes del insumo
            if (lotesLink) {
                lotesLink.href = `/insumos/detalle/${insumoOption.value}/?from=receta&id_rec={{ receta.id_rec }}`;
                lotesLink.style.pointerEvents = 'auto';
                lotesLink.style.opacity = '1';
            }
        } else {
            unidadInfo.textContent = '';
            if (lotesLink) {
                lotesLink.href = '#';
                lotesLink.style.pointerEvents = 'none';
                lotesLink.style.opacity = '.5';
            }
        }
    }
    
    insumoSelect.addEventListener('change', mostrarUnidad);



    // Env√≠o del formulario
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validaci√≥n simple
        const insumoSelect = document.getElementById('insumo');
        const cantidadInput = document.getElementById('cantidad');
        
        console.log('=== SIMPLE DEBUG ===');
        console.log('Insumo seleccionado:', insumoSelect.value);
        console.log('Cantidad ingresada:', cantidadInput.value);
        
        if (!insumoSelect.value) {
            alert('Selecciona un insumo');
            return;
        }
        
        if (!cantidadInput.value) {
            alert('Ingresa una cantidad');
            return;
        }
        
        // Enviar formulario normalmente (sin AJAX)
        console.log('Enviando formulario...');
        form.action = '{% url "recetas:agregar_ingrediente" receta.id_rec %}';
        form.method = 'POST';
        form.submit();
    });
});

// Funciones globales
function abrirModalAgregar() {
    console.log('Abriendo modal para agregar ingrediente');
    
    // Limpiar formulario
    document.getElementById('formIngrediente').reset();
    document.getElementById('ingredienteId').value = '';
    document.getElementById('unidadInfo').textContent = '';
    
    // Configurar modal para agregar
    document.getElementById('modalTitulo').textContent = 'Agregar Ingrediente';
    document.getElementById('campoSelectInsumo').style.display = 'block';
    document.getElementById('campoNombreInsumo').style.display = 'none';
    document.getElementById('insumo').required = true;
    
    // Mostrar modal
    document.getElementById('modalIngrediente').style.display = 'block';
    
    console.log('Modal abierto correctamente');
}

function editarIngrediente(id) {
    console.log('üîç Editando ingrediente:', id);
    
    // Obtener datos del ingrediente
    const obtenerUrl = `/recetas/ingrediente/${id}/`;
    console.log('üîç URL para obtener ingrediente:', obtenerUrl);
    
    fetch(obtenerUrl, {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('‚úÖ Datos recibidos:', data);
            // Llenar el formulario con los datos existentes
            document.getElementById('ingredienteId').value = id;
            document.getElementById('cantidad').value = data.cantidad;
            
            // Configurar modal para editar (select oculto, readonly visible)
            document.getElementById('campoSelectInsumo').style.display = 'none';
            document.getElementById('campoNombreInsumo').style.display = 'block';
            document.getElementById('insumo').required = false;
            
            // Mostrar nombre del insumo (readonly) y guardar ID
            document.getElementById('nombreInsumoDisplay').textContent = data.nombre_insumo + ' - ' + data.unidad;
            document.getElementById('insumoIdHidden').value = data.insumo_id;
            document.getElementById('unidadInfo').textContent = `Unidad: ${data.unidad}`;
            // Activar link lotes en modo editar
            if (lotesLinkEditar) {
                lotesLinkEditar.href = `/insumos/detalle/${data.insumo_id}/?from=receta&id_rec={{ receta.id_rec }}`;
                lotesLinkEditar.style.pointerEvents = 'auto';
                lotesLinkEditar.style.opacity = '1';
            }
            
            // Cambiar t√≠tulo del modal
            document.getElementById('modalTitulo').textContent = 'Editar Ingrediente';
            
            // Abrir modal
            document.getElementById('modalIngrediente').style.display = 'block';
            
            console.log('‚úÖ Datos cargados para edici√≥n');
        } else {
            console.error('‚ùå Error:', data.error);
            alert('Error al cargar los datos: ' + (data.error || 'Error desconocido'));
        }
    })
    .catch(error => {
        console.error('‚ùå Error de conexi√≥n:', error);
        alert('Error de conexi√≥n al cargar los datos del ingrediente');
    });
}

function confirmarEliminar(ingredienteId, nombreInsumo) {
    if (confirm(`¬øEst√°s seguro de que deseas eliminar "${nombreInsumo}" de esta receta?`)) {
        const url = `{% url 'recetas:eliminar_ingrediente' receta.id_rec 0 %}`.replace('0', ingredienteId);
        
        console.log('üîç JS DEBUG: Eliminando ingrediente con URL:', url);
        
        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => {
            console.log('üîç JS DEBUG: Response status:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('üîç JS DEBUG: Response data:', data);
            if (data.success) {
                location.reload();
            } else {
                alert(data.error || 'Error al eliminar el ingrediente');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error de conexi√≥n');
        });
    }
}

function cerrarModal() {
    // Limpiar formulario
    document.getElementById('formIngrediente').reset();
    document.getElementById('ingredienteId').value = '';
    document.getElementById('unidadInfo').textContent = '';
    document.getElementById('nombreInsumoDisplay').textContent = '';
    document.getElementById('insumoIdHidden').value = '';
    // Reset links
    if (lotesLink) {
        lotesLink.href = '#';
        lotesLink.style.pointerEvents = 'none';
        lotesLink.style.opacity = '.5';
    }
    if (lotesLinkEditar) {
        lotesLinkEditar.href = '#';
        lotesLinkEditar.style.pointerEvents = 'none';
        lotesLinkEditar.style.opacity = '.5';
    }
    
    // Restaurar modo agregar por defecto
    document.getElementById('campoSelectInsumo').style.display = 'block';
    document.getElementById('campoNombreInsumo').style.display = 'none';
    document.getElementById('insumo').required = true;
    
    // Restaurar t√≠tulo del modal
    document.getElementById('modalTitulo').textContent = 'Agregar Ingrediente';
    
    // Cerrar modal
    document.getElementById('modalIngrediente').style.display = 'none';
}

// Cerrar modal al hacer clic fuera
document.getElementById('modalIngrediente').addEventListener('click', function(e) {
    if (e.target === this) {
        cerrarModal();
    }
});
</script>
{% endblock %}