<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>Gestionar Recetas de Venta</title>
    <h:outputStylesheet library="css" name="formularios.css" />

    <style>
        .card-form {
            max-width: 1200px;
            width: 95%;
            padding: 25px;
            margin: 20px auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .fila { display: flex; flex-wrap: wrap; gap: 8px 10px; margin-bottom: 10px; }
        .campo { flex: 1 1 150px; display: flex; flex-direction: column; }
        .campo label { margin-bottom: 3px; font-weight: 500; font-size: 0.95rem; }
        .campo h\:inputText, .campo h\:selectOneMenu, .campo p\:inputText, .campo p\:selectOneMenu { 
            width: 100%; padding: 6px 10px; font-size: 0.95rem; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-family: Arial, sans-serif; }
        th, td { padding: 10px 12px; border: 1px solid #ddd; }
        th { background-color: #f2f2f2; text-align: left; }
        .btn { padding: 6px 14px; border-radius: 5px; cursor: pointer; font-weight: 500; }
        .btn-primario { background-color: #007bff; color: white; border: none; }
        .btn-secundario { background-color: #6c757d; color: white; border: none; }
        .btn-outline-success { border: 1px solid #28a745; color: #28a745; background: none; }
        .btn-outline-danger { border: 1px solid #dc3545; color: #dc3545; background: none; }
        .btn-sm { padding: 4px 10px; font-size: 0.85rem; }

        /* MODAL */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); transition: opacity 0.3s ease; }
        .modal-content { background-color: #fff; margin: 80px auto; padding: 20px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 8px 25px rgba(0,0,0,0.25); position: relative; animation: slideDown 0.3s ease; }
        .modal-header { font-size: 1.25rem; font-weight: bold; margin-bottom: 12px; text-align: center; }
        .modal-footer { margin-top: 12px; display: flex; justify-content: flex-end; gap: 8px; }
        .close { position: absolute; top: 8px; right: 10px; font-size: 1.3rem; font-weight: bold; color: #555; cursor: pointer; transition: color 0.2s ease; }
        .close:hover { color: #000; }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        body.dark th {
    background-color: #2a2a2a !important;
    color: #ffffff !important;
}

body.dark td {
    background-color: #1f1f1f !important;
    color: #e0e0e0 !important;
}

body.dark table,
body.dark th,
body.dark td {
    border-color: #444 !important;
}

body.dark .btn.btn-primario {
    background-color: transparent !important;
    color: #ffffff !important;
    border: 1px solid #0d6efd !important;
}

body.dark .btn.btn-primario:hover {
    background-color: rgba(13, 110, 253, 0.2) !important;
}

body.dark .btn.btn-secundario {
    background-color: transparent !important;
    color: #ffffff !important;
    border: 1px solid #6c757d !important;
}

body.dark .btn.btn-secundario:hover {
    background-color: rgba(255, 255, 255, 0.15) !important;
}

/* MODOS OSCUROS PARA MODALES */
body.dark .modal .modal-content {
    background-color: #1f1f1f !important; /* Fondo modal */
    color: #e0e0e0 !important; /* Texto general */
    border-radius: 8px; /* Bordes redondeados */
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

body.dark .modal .modal-header {
    background-color: #2a2a2a !important; /* Encabezado */
    color: #ffffff !important;
    font-weight: bold;
    padding: 10px 15px;
    border-bottom: 1px solid #444;
}

body.dark .modal .close {
    color: #ffffff !important; /* Botón cerrar */
}

body.dark .modal .campo label {
    color: #e0e0e0 !important; /* Labels */
}

body.dark .modal .btn.btn-primario {
    background-color: transparent !important;
    color: #ffffff !important;
    border: 1px solid #0d6efd !important;
}

body.dark .modal .btn.btn-primario:hover {
    background-color: rgba(255,255,255,0.1) !important;
}

body.dark .modal .btn.btn-secundario {
    background-color: transparent !important;
    color: #e0e0e0 !important;
    border: 1px solid #888 !important;
}

body.dark .modal .btn.btn-secundario:hover {
    background-color: rgba(255,255,255,0.05) !important;
}

/* Inputs y selects en modo oscuro */
body.dark .modal input,
body.dark .modal select,
body.dark .modal .ui-inputfield,
body.dark .modal .ui-calendar {
    background-color: #2a2a2a !important;
    color: #e0e0e0 !important;
    border: 1px solid #555 !important;
}

body.dark .modal .modal-footer {
    border-top: 1px solid #444;
}

    </style>

    <script type="text/javascript">
        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</h:head>

<h:body>
    <ui:include src="/views/Navbar.xhtml" />
    <p:growl id="msj" showDetail="true" showSummary="true" />

    <f:metadata>
        <f:viewParam name="idVenta" value="#{venta_recetasBean.idVentaSeleccionada}" />
        <f:viewAction action="#{venta_recetasBean.listar}" />
    </f:metadata>

    <section class="home">
        <div class="card-form">
            <h2>Recetas de la Venta ##{venta_recetasBean.idVentaSeleccionada}</h2>

            <h:form id="formRecetas">
                <!-- Botón abrir modal agregar receta -->
                <button type="button" class="btn btn-primario" onclick="openModal('modalAgregarReceta')">+ Agregar Receta</button>
                <button type="button" class="btn btn-secundario" onclick="history.back()">
                    <i class="bi bi-arrow-left"></i> Volver
                </button>

                <!-- Tabla de recetas -->
                <h:panelGroup id="tablaRecetas">
                    <table>
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Receta</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Subtotal</th>
                                <th>Opciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <ui:repeat value="#{venta_recetasBean.lstVentaRecetas}" var="vr">
                                <tr>
                                    <td>#{vr.idReceta}</td>
                                    <td>#{vr.nombreReceta}</td>
                                    <td>#{vr.cantidad}</td>
                                    <td>#{vr.precio}</td>
                                    <td>#{vr.subtotal}</td>
                                    <td>
                                        <h:commandLink action="#{venta_recetasBean.eliminar(vr)}"
                                            styleClass="btn btn-outline-danger btn-sm"
                                            onclick="return confirm('¿Está seguro de eliminar esta receta?');">
                                            <i class="bi bi-trash"></i>
                                        </h:commandLink>
                                    </td>
                                </tr>
                            </ui:repeat>
                        </tbody>
                    </table>
                </h:panelGroup>
            </h:form>
        </div>
    </section>

    <!-- MODAL AGREGAR RECETA -->
  <!-- MODAL AGREGAR RECETA -->
<div id="modalAgregarReceta" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('modalAgregarReceta')">&#215;</span>
        <div class="modal-header">Agregar Receta</div>
        <h:form id="formAgregarReceta">
            <div class="fila">
                <div class="campo">
                    <label>Receta:</label>
                    <!-- Select simple, sin recuadro de PrimeFaces -->
                    <h:selectOneMenu value="#{venta_recetasBean.ventaReceta.idReceta}" styleClass="input" required="true">
                        <f:selectItem itemLabel="-- Seleccione Receta --" itemValue="#{null}" />
                        <f:selectItems value="#{ventasBean.listaRecetas}" var="r"
                            itemLabel="#{r.nombre}" itemValue="#{r.id_rec}" />
                    </h:selectOneMenu>
                    <h:message for="ventaRecetasBean.ventaReceta.idReceta" styleClass="text-danger" />
                </div>
                <div class="campo">
                    <label>Cantidad:</label>
                    <h:inputText value="#{venta_recetasBean.ventaReceta.cantidad}" styleClass="input" required="true" />
                    <h:message for="ventaRecetasBean.ventaReceta.cantidad" styleClass="text-danger" />
                </div>
            </div>
            <div class="modal-footer">
                <h:commandButton value="Agregar" action="#{venta_recetasBean.agregar}" styleClass="btn btn-primario">
                    <f:ajax execute="@form" render="tablaRecetas msj"/>
                </h:commandButton>
                <button type="button" class="btn btn-secundario" onclick="closeModal('modalAgregarReceta')">Cancelar</button>
            </div>
        </h:form>
    </div>
</div>


</h:body>
</html>
